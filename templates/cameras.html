<!doctype html>
<html>
    <head>
        <title>Available Cameras</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                background: #f0f0f0;
                padding: 0;
                margin: 0;
            }
            .navbar {
                background: #333;
                padding: 1rem;
                display: flex;
                justify-content: center;
                gap: 2rem;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }
            .navbar a {
                color: white;
                text-decoration: none;
                padding: 0.5rem 1.5rem;
                border-radius: 5px;
                transition: background 0.3s;
            }
            .navbar a:hover {
                background: #555;
            }
            .navbar a.active {
                background: #4caf50;
            }
            .container {
                max-width: 1200px;
                margin: 2rem auto;
                padding: 0 2rem;
            }
            .header {
                background: white;
                padding: 2rem;
                border-radius: 10px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                margin-bottom: 2rem;
            }
            .stats {
                display: flex;
                gap: 2rem;
                justify-content: center;
                margin-top: 1rem;
            }
            .stat-card {
                background: #4caf50;
                color: white;
                padding: 1rem 2rem;
                border-radius: 8px;
                text-align: center;
            }
            .stat-card h3 {
                margin: 0;
                font-size: 2rem;
            }
            .stat-card p {
                margin: 0.5rem 0 0 0;
                opacity: 0.9;
            }
            .camera-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
                gap: 2rem;
            }
            .camera-card {
                background: white;
                border-radius: 10px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                overflow: hidden;
                transition: transform 0.3s;
            }
            .camera-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            }
            .camera-preview {
                width: 100%;
                height: 250px;
                background: #333;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                cursor: pointer;
                position: relative;
            }
            .camera-preview img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            .preview-placeholder {
                font-size: 3rem;
                opacity: 0.3;
            }
            .camera-info {
                padding: 1.5rem;
            }
            .camera-name {
                font-size: 1.3rem;
                font-weight: bold;
                margin: 0 0 1rem 0;
                color: #333;
            }
            .info-row {
                display: flex;
                justify-content: space-between;
                padding: 0.5rem 0;
                border-bottom: 1px solid #eee;
            }
            .info-row:last-child {
                border-bottom: none;
            }
            .info-label {
                color: #666;
                font-weight: 500;
            }
            .info-value {
                color: #333;
            }
            .status-badge {
                display: inline-block;
                padding: 0.25rem 0.75rem;
                border-radius: 12px;
                font-size: 0.85rem;
                font-weight: bold;
            }
            .status-active {
                background: #4caf50;
                color: white;
            }
            .status-inactive {
                background: #f44336;
                color: white;
            }
            .status-error {
                background: #ff9800;
                color: white;
            }
            .loading {
                text-align: center;
                padding: 4rem;
                color: #666;
                font-size: 1.2rem;
            }
            .refresh-btn {
                background: #2196f3;
                color: white;
                border: none;
                padding: 0.75rem 1.5rem;
                border-radius: 5px;
                cursor: pointer;
                font-size: 1rem;
                margin-top: 1rem;
            }
            .refresh-btn:hover {
                background: #0b7dda;
            }
            .preview-btn {
                background: #4caf50;
                color: white;
                border: none;
                padding: 0.5rem 1rem;
                border-radius: 5px;
                cursor: pointer;
                margin-top: 1rem;
                width: 100%;
            }
            .preview-btn:hover {
                background: #45a049;
            }
        </style>
    </head>
    <body>
        <div class="navbar">
            <a href="{{ url_for('index') }}">Camera Feeds</a>
            <a href="{{ url_for('cameras') }}" class="active"
                >Available Cameras</a
            >
        </div>

        <div class="container">
            <div class="header">
                <h1>Camera Monitoring Dashboard</h1>
                <div class="stats">
                    <div class="stat-card">
                        <h3 id="total-cameras">0</h3>
                        <p>Total Cameras</p>
                    </div>
                    <div class="stat-card" style="background: #2196f3">
                        <h3 id="active-cameras">0</h3>
                        <p>Active Cameras</p>
                    </div>
                    <div class="stat-card" style="background: #ff9800">
                        <h3 id="inactive-cameras">0</h3>
                        <p>Inactive Cameras</p>
                    </div>
                </div>
                <button class="refresh-btn" onclick="loadCameras()">
                    Refresh Camera List
                </button>
            </div>

            <div id="camera-list">
                <div class="loading">Scanning for cameras...</div>
            </div>
        </div>

        <script>
            function loadCameras() {
                const container = document.getElementById("camera-list");
                container.innerHTML =
                    '<div class="loading">Scanning for cameras...</div>';

                fetch("/api/cameras")
                    .then((response) => response.json())
                    .then((cameras) => {
                        if (cameras.length === 0) {
                            container.innerHTML =
                                '<div class="loading">No cameras found</div>';
                            return;
                        }

                        // Update stats
                        document.getElementById("total-cameras").textContent =
                            cameras.length;
                        const activeCameras = cameras.filter(
                            (cam) => cam.status === "Active",
                        ).length;
                        document.getElementById("active-cameras").textContent =
                            activeCameras;
                        document.getElementById(
                            "inactive-cameras",
                        ).textContent = cameras.length - activeCameras;

                        // Create camera grid
                        let html = '<div class="camera-grid">';

                        cameras.forEach((cam) => {
                            const statusClass =
                                cam.status === "Active"
                                    ? "status-active"
                                    : cam.status === "Inactive"
                                      ? "status-inactive"
                                      : "status-error";

                            html += `
                                <div class="camera-card">
                                    <div class="camera-preview" onclick="togglePreview(${cam.id})">
                                        <div class="preview-placeholder" id="placeholder-${cam.id}">üì∑</div>
                                        <img id="preview-${cam.id}" style="display: none;" />
                                    </div>
                                    <div class="camera-info">
                                        <h2 class="camera-name">${cam.name}</h2>
                                        <div class="info-row">
                                            <span class="info-label">Status:</span>
                                            <span class="status-badge ${statusClass}">${cam.status}</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label">Index:</span>
                                            <span class="info-value">${cam.index}</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label">Resolution:</span>
                                            <span class="info-value">${cam.resolution}</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label">FPS:</span>
                                            <span class="info-value">${cam.fps}</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label">Backend:</span>
                                            <span class="info-value">${cam.backend}</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label">Path:</span>
                                            <span class="info-value">${cam.path}</span>
                                        </div>
                                        <button class="preview-btn" onclick="togglePreview(${cam.id})">
                                            Toggle Live Preview
                                        </button>
                                    </div>
                                </div>
                            `;
                        });

                        html += "</div>";
                        container.innerHTML = html;
                    })
                    .catch((error) => {
                        console.error("Error:", error);
                        container.innerHTML =
                            '<div class="loading" style="color: red;">‚ùå Error loading cameras</div>';
                    });
            }

            function togglePreview(cameraId) {
                const img = document.getElementById(`preview-${cameraId}`);
                const placeholder = document.getElementById(
                    `placeholder-${cameraId}`,
                );

                if (img.style.display === "none") {
                    img.src = `/api/camera/${cameraId}/preview`;
                    img.style.display = "block";
                    placeholder.style.display = "none";
                } else {
                    img.style.display = "none";
                    img.src = "";
                    placeholder.style.display = "block";
                }
            }

            // Load cameras on page load
            loadCameras();

            // Auto-refresh every 30 seconds
            setInterval(loadCameras, 30000);
        </script>
    </body>
</html>
